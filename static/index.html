<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Crasher Bot Dashboard</title>
        <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Oxygen, Ubuntu, Cantarell, sans-serif;
                background: #0a0e27;
                color: #e0e0e0;
                line-height: 1.6;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
            }

            header {
                background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                padding: 20px 0;
                margin-bottom: 30px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            }

            h1 {
                text-align: center;
                font-size: 2.5rem;
                color: #fff;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            }

            nav {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin-top: 15px;
            }

            nav button {
                background: rgba(255, 255, 255, 0.1);
                border: 2px solid rgba(255, 255, 255, 0.3);
                color: #fff;
                padding: 10px 25px;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1rem;
                transition: all 0.3s;
            }

            nav button:hover {
                background: rgba(255, 255, 255, 0.2);
                border-color: rgba(255, 255, 255, 0.5);
            }

            nav button.active {
                background: rgba(255, 255, 255, 0.3);
                border-color: #fff;
            }

            .page {
                display: none;
            }

            .page.active {
                display: block;
            }

            .card {
                background: #15192e;
                border-radius: 10px;
                padding: 25px;
                margin-bottom: 20px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .card h2 {
                margin-bottom: 20px;
                color: #4fc3f7;
                font-size: 1.5rem;
            }

            /* Bot Control */
            .control-buttons {
                display: flex;
                gap: 15px;
                margin-bottom: 20px;
            }

            .btn {
                padding: 12px 30px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1rem;
                font-weight: 600;
                transition: all 0.3s;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .btn-start {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
            }

            .btn-start:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
            }

            .btn-stop {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                color: #fff;
            }

            .btn-stop:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(245, 87, 108, 0.4);
            }

            .btn-add {
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                color: #fff;
            }

            .btn-add:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(79, 172, 254, 0.4);
            }

            .status-box {
                background: rgba(255, 255, 255, 0.05);
                padding: 15px;
                border-radius: 5px;
                margin-bottom: 15px;
            }

            .status-box .status-item {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .status-box .status-item:last-child {
                border-bottom: none;
            }

            .status-running {
                color: #4caf50;
                font-weight: bold;
            }

            .status-stopped {
                color: #f44336;
                font-weight: bold;
            }

            /* Strategies */
            .strategies-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                gap: 20px;
            }

            .strategy-card {
                background: rgba(255, 255, 255, 0.03);
                padding: 20px;
                border-radius: 8px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                transition: all 0.3s;
            }

            .strategy-card:hover {
                background: rgba(255, 255, 255, 0.05);
                border-color: rgba(255, 255, 255, 0.2);
            }

            .strategy-card h3 {
                color: #4fc3f7;
                margin-bottom: 15px;
                font-size: 1.2rem;
            }

            .strategy-field {
                display: flex;
                justify-content: space-between;
                padding: 5px 0;
                font-size: 0.9rem;
            }

            .strategy-field label {
                color: #aaa;
            }

            .strategy-field span {
                color: #fff;
                font-weight: 500;
            }

            .strategy-actions {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }

            .btn-edit,
            .btn-delete {
                flex: 1;
                padding: 8px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 0.9rem;
                transition: all 0.3s;
            }

            .btn-edit {
                background: #2196f3;
                color: #fff;
            }

            .btn-edit:hover {
                background: #1976d2;
            }

            .btn-delete {
                background: #f44336;
                color: #fff;
            }

            .btn-delete:hover {
                background: #d32f2f;
            }

            /* Modal */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 1000;
                overflow-y: auto;
            }

            .modal.active {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .modal-content {
                background: #15192e;
                padding: 30px;
                border-radius: 10px;
                max-width: 500px;
                width: 90%;
                max-height: 90vh;
                overflow-y: auto;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .modal-content h2 {
                color: #4fc3f7;
                margin-bottom: 20px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                display: block;
                margin-bottom: 5px;
                color: #aaa;
                font-size: 0.9rem;
            }

            .form-group input {
                width: 100%;
                padding: 10px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 5px;
                background: rgba(255, 255, 255, 0.05);
                color: #fff;
                font-size: 1rem;
            }

            .form-group input:focus {
                outline: none;
                border-color: #4fc3f7;
                background: rgba(255, 255, 255, 0.08);
            }

            .modal-actions {
                display: flex;
                gap: 10px;
                margin-top: 25px;
            }

            .btn-cancel {
                flex: 1;
                padding: 12px;
                background: #666;
                color: #fff;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1rem;
            }

            .btn-cancel:hover {
                background: #555;
            }

            .btn-save {
                flex: 1;
                padding: 12px;
                background: #4caf50;
                color: #fff;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 1rem;
                font-weight: 600;
            }

            .btn-save:hover {
                background: #45a049;
            }

            /* Multipliers Display */
            .multipliers-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }

            .multipliers-container {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                padding: 20px;
                background: rgba(0, 0, 0, 0.3);
                border-radius: 10px;
                max-height: 600px;
                overflow-y: auto;
            }

            .multiplier-item {
                min-width: 70px;
                padding: 5px 2px;
                border-radius: 8px;
                text-align: center;
                font-weight: 600;
                font-size: 1rem;
                transition: all 0.3s;
                cursor: pointer;
                position: relative;
            }

            .multiplier-item:hover {
                transform: scale(1.1);
                z-index: 10;
            }

            .multiplier-item.has-bet {
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
                border: 2px solid #ffd700;
            }

            .multiplier-item.bet-win {
                box-shadow: 0 0 15px rgba(76, 175, 80, 0.7);
                border: 2px solid #4caf50;
            }

            .multiplier-item.bet-loss {
                box-shadow: 0 0 15px rgba(244, 67, 54, 0.7);
                border: 2px solid #f44336;
            }

            /* Color coding by multiplier value */
            .multiplier-green {
                background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
                color: #fff;
            }

            .multiplier-yellow {
                background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
                color: #000;
            }

            .multiplier-white {
                background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
                color: #000;
            }

            .multiplier-red {
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
                color: #fff;
            }

            /* Bets Table */
            .bets-container {
                overflow-x: auto;
            }

            table {
                width: 100%;
                border-collapse: collapse;
            }

            thead {
                background: rgba(255, 255, 255, 0.05);
            }

            th {
                padding: 12px;
                text-align: left;
                color: #4fc3f7;
                font-weight: 600;
                border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            }

            td {
                padding: 12px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            tr:hover {
                background: rgba(255, 255, 255, 0.03);
            }

            .outcome-win {
                color: #4caf50;
                font-weight: 600;
            }

            .outcome-loss {
                color: #f44336;
                font-weight: 600;
            }

            .profit-positive {
                color: #4caf50;
            }

            .profit-negative {
                color: #f44336;
            }

            /* Session Selector */
            .session-selector {
                margin-bottom: 20px;
            }

            .session-selector select {
                width: 100%;
                padding: 10px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 5px;
                background: rgba(255, 255, 255, 0.05);
                color: #fff;
                font-size: 1rem;
            }

            .session-selector select:focus {
                outline: none;
                border-color: #4fc3f7;
            }

            /* Loading */
            .loading {
                text-align: center;
                padding: 40px;
                color: #aaa;
            }

            .loading::after {
                content: "...";
                animation: dots 1.5s steps(4, end) infinite;
            }

            @keyframes dots {
                0%,
                20% {
                    content: ".";
                }
                40% {
                    content: "..";
                }
                60%,
                100% {
                    content: "...";
                }
            }

            /* Logs Panel */
            .logs-panel {
                background: #0d1117;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 20px;
                max-height: 500px;
                overflow-y: auto;
                font-family: "Courier New", monospace;
                font-size: 0.85rem;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .logs-panel h2 {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Oxygen, Ubuntu, Cantarell, sans-serif;
                margin-bottom: 15px;
                color: #4fc3f7;
            }

            .log-entry {
                padding: 8px 12px;
                margin-bottom: 4px;
                border-radius: 4px;
                background: rgba(255, 255, 255, 0.02);
                border-left: 3px solid transparent;
                transition: all 0.2s;
                word-wrap: break-word;
            }

            .log-entry:hover {
                background: rgba(255, 255, 255, 0.05);
            }

            .log-entry.log-info {
                border-left-color: #2196f3;
            }

            .log-entry.log-warning {
                border-left-color: #ff9800;
                background: rgba(255, 152, 0, 0.05);
            }

            .log-entry.log-error {
                border-left-color: #f44336;
                background: rgba(244, 67, 54, 0.05);
            }

            .log-timestamp {
                color: #666;
                margin-right: 10px;
            }

            .log-level {
                display: inline-block;
                padding: 2px 8px;
                border-radius: 3px;
                font-size: 0.75rem;
                font-weight: 600;
                margin-right: 10px;
                min-width: 60px;
                text-align: center;
            }

            .log-level.INFO {
                background: rgba(33, 150, 243, 0.2);
                color: #4fc3f7;
            }

            .log-level.WARNING {
                background: rgba(255, 152, 0, 0.2);
                color: #ffb74d;
            }

            .log-level.ERROR {
                background: rgba(244, 67, 54, 0.2);
                color: #ef5350;
            }

            .log-message {
                color: #e0e0e0;
            }

            .logs-controls {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }

            .btn-clear-logs {
                padding: 8px 16px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                color: #fff;
                border-radius: 5px;
                cursor: pointer;
                font-size: 0.9rem;
                transition: all 0.3s;
            }

            .btn-clear-logs:hover {
                background: rgba(255, 255, 255, 0.15);
            }

            .connection-status {
                padding: 8px 16px;
                border-radius: 5px;
                font-size: 0.85rem;
                display: inline-flex;
                align-items: center;
                gap: 8px;
            }

            .connection-status::before {
                content: "";
                width: 8px;
                height: 8px;
                border-radius: 50%;
                animation: pulse 2s infinite;
            }

            .connection-status.connected {
                background: rgba(76, 175, 80, 0.2);
                color: #4caf50;
            }

            .connection-status.connected::before {
                background: #4caf50;
            }

            .connection-status.disconnected {
                background: rgba(244, 67, 54, 0.2);
                color: #f44336;
            }

            .connection-status.disconnected::before {
                background: #f44336;
                animation: none;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }

            .auto-scroll-toggle {
                display: flex;
                align-items: center;
                gap: 8px;
                color: #aaa;
                font-size: 0.9rem;
            }

            .auto-scroll-toggle input[type="checkbox"] {
                width: 18px;
                height: 18px;
                cursor: pointer;
            }

            /* Scrollbar */
            ::-webkit-scrollbar {
                width: 10px;
                height: 10px;
            }

            ::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.05);
            }

            ::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.2);
                border-radius: 5px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.3);
            }
        </style>
    </head>
    <body>
        <header>
            <div class="container">
                <h1>üé∞ Crasher Bot Dashboard</h1>
                <nav>
                    <button class="nav-btn active" data-page="control">
                        Control Panel
                    </button>
                    <button class="nav-btn" data-page="multipliers">
                        Multipliers View
                    </button>
                </nav>
            </div>
        </header>

        <div class="container">
            <!-- Control Panel Page -->
            <div id="control-page" class="page active">
                <!-- Bot Control -->
                <div class="card">
                    <h2>Bot Control</h2>
                    <div class="control-buttons">
                        <button class="btn btn-start" onclick="startBot()">
                            ‚ñ∂ Start Bot
                        </button>
                        <button class="btn btn-stop" onclick="stopBot()">
                            ‚èπ Stop Bot
                        </button>
                    </div>
                    <div class="status-box" id="bot-status">
                        <div class="status-item">
                            <span>Status:</span>
                            <span id="status-text" class="status-stopped"
                                >Stopped</span
                            >
                        </div>
                        <div class="status-item">
                            <span>Session ID:</span>
                            <span id="status-session">-</span>
                        </div>
                        <div class="status-item">
                            <span>Total Profit/Loss:</span>
                            <span id="status-profit">0</span>
                        </div>
                        <div class="status-item">
                            <span>Running Since:</span>
                            <span id="status-start-time">-</span>
                        </div>
                    </div>
                </div>

                <!-- Real-time Logs -->
                <div class="card">
                    <h2>Real-time Logs</h2>
                    <div class="logs-controls">
                        <span
                            class="connection-status disconnected"
                            id="connection-status"
                            >Disconnected</span
                        >
                        <button class="btn-clear-logs" onclick="clearLogs()">
                            Clear Logs
                        </button>
                        <label class="auto-scroll-toggle">
                            <input
                                type="checkbox"
                                id="auto-scroll-checkbox"
                                checked
                            />
                            Auto-scroll
                        </label>
                    </div>
                    <div class="logs-panel" id="logs-container">
                        <div class="log-entry log-info">
                            <span class="log-message"
                                >Waiting for connection...</span
                            >
                        </div>
                    </div>
                </div>

                <!-- Strategies -->
                <div class="card">
                    <div
                        style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 20px;
                        "
                    >
                        <h2 style="margin: 0">Strategies</h2>
                        <button
                            class="btn btn-add"
                            onclick="openStrategyModal()"
                        >
                            + Add Strategy
                        </button>
                    </div>
                    <div class="strategies-grid" id="strategies-container">
                        <div class="loading">Loading strategies</div>
                    </div>
                </div>

                <!-- Recent Multipliers -->
                <div class="card">
                    <h2>Recent Multipliers (Last 50)</h2>
                    <div class="multipliers-container" id="recent-multipliers">
                        <div class="loading">Loading multipliers</div>
                    </div>
                </div>

                <!-- Bets -->
                <div class="card">
                    <h2>Recent Bets (Current Session)</h2>
                    <div class="bets-container">
                        <table id="bets-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Strategy</th>
                                    <th>Bet Amount</th>
                                    <th>Multiplier</th>
                                    <th>Outcome</th>
                                    <th>Profit/Loss</th>
                                </tr>
                            </thead>
                            <tbody id="bets-tbody">
                                <tr>
                                    <td colspan="6" class="loading">
                                        Loading bets
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Multipliers View Page -->
            <div id="multipliers-page" class="page">
                <div class="card">
                    <div class="multipliers-header">
                        <h2>Session Multipliers</h2>
                    </div>

                    <div class="session-selector">
                        <label
                            for="session-select"
                            style="
                                color: #aaa;
                                display: block;
                                margin-bottom: 10px;
                            "
                            >Select Session:</label
                        >
                        <select
                            id="session-select"
                            onchange="loadSessionMultipliers()"
                        >
                            <option value="">Loading sessions...</option>
                        </select>
                        <button class="btn" onClick="loadSessionMultipliers()">
                            Refresh
                        </button>
                    </div>

                    <div class="multipliers-container" id="session-multipliers">
                        <div class="loading">
                            Select a session to view multipliers
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Modal -->
        <div id="strategy-modal" class="modal">
            <div class="modal-content">
                <h2 id="modal-title">Add Strategy</h2>
                <form id="strategy-form">
                    <div class="form-group">
                        <label for="strategy-name">Strategy Name *</label>
                        <input type="text" id="strategy-name" required />
                    </div>
                    <div class="form-group">
                        <label for="base-bet">Base Bet *</label>
                        <input
                            type="number"
                            id="base-bet"
                            step="0.01"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="auto-cashout">Auto Cashout *</label>
                        <input
                            type="number"
                            id="auto-cashout"
                            step="0.01"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="trigger-threshold"
                            >Trigger Threshold *</label
                        >
                        <input
                            type="number"
                            id="trigger-threshold"
                            step="0.01"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="trigger-count">Trigger Count *</label>
                        <input type="number" id="trigger-count" required />
                    </div>
                    <div class="form-group">
                        <label for="max-losses">Max Consecutive Losses</label>
                        <input type="number" id="max-losses" value="100" />
                    </div>
                    <div class="form-group">
                        <label for="bet-multiplier">Bet Multiplier</label>
                        <input
                            type="number"
                            id="bet-multiplier"
                            step="0.00001"
                        />
                    </div>
                    <div class="modal-actions">
                        <button
                            type="button"
                            class="btn-cancel"
                            onclick="closeStrategyModal()"
                        >
                            Cancel
                        </button>
                        <button type="submit" class="btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            const API_BASE = "";
            let updateInterval = null;
            let currentEditStrategy = null;
            let socket = null;
            let autoScroll = true;
            const MAX_LOG_ENTRIES = 500; // Keep last 500 log entries

            // WebSocket Setup
            function initializeWebSocket() {
                socket = io({
                    transports: ["websocket", "polling"],
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionAttempts: 10,
                });

                socket.on("connect", () => {
                    console.log("WebSocket connected");
                    updateConnectionStatus(true);
                    addLogEntry({
                        level: "INFO",
                        message: "‚úì WebSocket connected to server",
                        timestamp: new Date().toISOString(),
                    });
                });

                socket.on("disconnect", () => {
                    console.log("WebSocket disconnected");
                    updateConnectionStatus(false);
                    addLogEntry({
                        level: "WARNING",
                        message: "‚úó WebSocket disconnected from server",
                        timestamp: new Date().toISOString(),
                    });
                });

                socket.on("log_message", (data) => {
                    addLogEntry(data);
                });

                socket.on("initial_logs", (data) => {
                    if (data.logs && data.logs.length > 0) {
                        data.logs.forEach((log) => addLogEntry(log, false));
                        scrollLogsToBottom();
                    }
                });

                socket.on("bot_status", (status) => {
                    updateBotStatusDisplay(status);
                });

                socket.on("connect_error", (error) => {
                    console.error("WebSocket connection error:", error);
                });
            }

            function updateConnectionStatus(connected) {
                const statusEl = document.getElementById("connection-status");
                if (connected) {
                    statusEl.className = "connection-status connected";
                    statusEl.textContent = "Connected";
                } else {
                    statusEl.className = "connection-status disconnected";
                    statusEl.textContent = "Disconnected";
                }
            }

            function addLogEntry(logData, shouldScroll = true) {
                const logsContainer = document.getElementById("logs-container");

                // Create log entry element
                const logEntry = document.createElement("div");
                logEntry.className = `log-entry log-${logData.level.toLowerCase()}`;

                const timestamp = new Date(
                    logData.timestamp,
                ).toLocaleTimeString();

                logEntry.innerHTML = `
                <span class="log-timestamp">${timestamp}</span>
                <span class="log-level ${logData.level}">${logData.level}</span>
                <span class="log-message">${escapeHtml(logData.message)}</span>
            `;

                // Add to container
                logsContainer.appendChild(logEntry);

                // Limit number of log entries
                while (logsContainer.children.length > MAX_LOG_ENTRIES) {
                    logsContainer.removeChild(logsContainer.firstChild);
                }

                // Auto-scroll if enabled
                if (shouldScroll && autoScroll) {
                    scrollLogsToBottom();
                }
            }

            function scrollLogsToBottom() {
                const logsContainer = document.getElementById("logs-container");
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }

            function clearLogs() {
                const logsContainer = document.getElementById("logs-container");
                logsContainer.innerHTML = "";
                addLogEntry({
                    level: "INFO",
                    message: "Logs cleared",
                    timestamp: new Date().toISOString(),
                });
            }

            function escapeHtml(text) {
                const div = document.createElement("div");
                div.textContent = text;
                return div.innerHTML;
            }

            // Auto-scroll toggle
            document.addEventListener("DOMContentLoaded", () => {
                const autoScrollCheckbox = document.getElementById(
                    "auto-scroll-checkbox",
                );
                autoScrollCheckbox.addEventListener("change", (e) => {
                    autoScroll = e.target.checked;
                    if (autoScroll) {
                        scrollLogsToBottom();
                    }
                });
            });

            // Page Navigation
            document.querySelectorAll(".nav-btn").forEach((btn) => {
                btn.addEventListener("click", () => {
                    const page = btn.dataset.page;

                    // Update nav buttons
                    document
                        .querySelectorAll(".nav-btn")
                        .forEach((b) => b.classList.remove("active"));
                    btn.classList.add("active");

                    // Update pages
                    document
                        .querySelectorAll(".page")
                        .forEach((p) => p.classList.remove("active"));
                    document
                        .getElementById(`${page}-page`)
                        .classList.add("active");

                    // Load data based on page
                    if (page === "multipliers") {
                        loadSessions();
                    }
                });
            });

            // Initialize
            document.addEventListener("DOMContentLoaded", () => {
                // Initialize WebSocket
                initializeWebSocket();

                // Load initial data
                loadStrategies();
                loadRecentMultipliers();
                loadBets();
                updateBotStatus();

                // Start auto-update for non-WebSocket data
                updateInterval = setInterval(() => {
                    updateBotStatus();
                    loadRecentMultipliers();
                    loadBets();
                }, 2000); // Update every 2 seconds
            });

            // Bot Control
            async function startBot() {
                try {
                    const response = await fetch(`${API_BASE}/api/bot/start`, {
                        method: "POST",
                    });
                    const data = await response.json();

                    if (data.success) {
                        alert("Bot started successfully!");
                    } else {
                        alert(`Failed to start bot: ${data.error}`);
                    }

                    updateBotStatus();
                } catch (error) {
                    alert(`Error starting bot: ${error.message}`);
                }
            }

            async function stopBot() {
                if (!confirm("Are you sure you want to stop the bot?")) return;

                try {
                    const response = await fetch(`${API_BASE}/api/bot/stop`, {
                        method: "POST",
                    });
                    const data = await response.json();

                    if (data.success) {
                        alert("Bot stopped successfully!");
                    } else {
                        alert(`Failed to stop bot: ${data.error}`);
                    }

                    updateBotStatus();
                } catch (error) {
                    alert(`Error stopping bot: ${error.message}`);
                }
            }

            async function updateBotStatus() {
                try {
                    const response = await fetch(`${API_BASE}/api/bot/status`);
                    const data = await response.json();
                    updateBotStatusDisplay(data);
                } catch (error) {
                    console.error("Error updating bot status:", error);
                }
            }

            function updateBotStatusDisplay(data) {
                const statusText = document.getElementById("status-text");
                statusText.textContent = data.running ? "Running" : "Stopped";
                statusText.className = data.running
                    ? "status-running"
                    : "status-stopped";

                document.getElementById("status-session").textContent =
                    data.current_session_id || "-";

                const profit = data.total_profit || 0;
                const profitEl = document.getElementById("status-profit");
                profitEl.textContent = profit.toFixed(0);
                profitEl.className =
                    profit >= 0 ? "profit-positive" : "profit-negative";

                document.getElementById("status-start-time").textContent =
                    data.start_time
                        ? new Date(data.start_time).toLocaleString()
                        : "-";
            }

            // Strategies
            async function loadStrategies() {
                try {
                    const response = await fetch(`${API_BASE}/api/strategies`);
                    const data = await response.json();

                    const container = document.getElementById(
                        "strategies-container",
                    );

                    if (
                        !data.success ||
                        !data.strategies ||
                        data.strategies.length === 0
                    ) {
                        container.innerHTML =
                            '<div class="loading">No strategies configured</div>';
                        return;
                    }

                    container.innerHTML = data.strategies
                        .map(
                            (strategy) => `
                    <div class="strategy-card">
                        <h3>${strategy.name}</h3>
                        <div class="strategy-field">
                            <label>Base Bet:</label>
                            <span>${strategy.base_bet}</span>
                        </div>
                        <div class="strategy-field">
                            <label>Auto Cashout:</label>
                            <span>${strategy.auto_cashout}x</span>
                        </div>
                        <div class="strategy-field">
                            <label>Trigger:</label>
                            <span>${strategy.trigger_count} rounds < ${strategy.trigger_threshold}x</span>
                        </div>
                        <div class="strategy-field">
                            <label>Max Losses:</label>
                            <span>${strategy.max_consecutive_losses}</span>
                        </div>
                        <div class="strategy-field">
                            <label>Bet Multiplier:</label>
                            <span>${strategy.bet_multiplier}x</span>
                        </div>
                        <div class="strategy-actions">
                            <button class="btn-edit" onclick='editStrategy(${JSON.stringify(strategy)})'>Edit</button>
                            <button class="btn-delete" onclick='deleteStrategy("${strategy.name}")'>Delete</button>
                        </div>
                    </div>
                `,
                        )
                        .join("");
                } catch (error) {
                    console.error("Error loading strategies:", error);
                }
            }

            function openStrategyModal(strategy = null) {
                const modal = document.getElementById("strategy-modal");
                const form = document.getElementById("strategy-form");

                if (strategy) {
                    document.getElementById("modal-title").textContent =
                        "Edit Strategy";
                    document.getElementById("strategy-name").value =
                        strategy.name;
                    document.getElementById("strategy-name").disabled = true;
                    document.getElementById("base-bet").value =
                        strategy.base_bet;
                    document.getElementById("auto-cashout").value =
                        strategy.auto_cashout;
                    document.getElementById("trigger-threshold").value =
                        strategy.trigger_threshold;
                    document.getElementById("trigger-count").value =
                        strategy.trigger_count;
                    document.getElementById("max-losses").value =
                        strategy.max_consecutive_losses || 100;
                    document.getElementById("bet-multiplier").value =
                        strategy.bet_multiplier || 2.0;
                    currentEditStrategy = strategy.name;
                } else {
                    document.getElementById("modal-title").textContent =
                        "Add Strategy";
                    form.reset();
                    document.getElementById("strategy-name").disabled = false;
                    currentEditStrategy = null;
                }

                modal.classList.add("active");
            }

            function closeStrategyModal() {
                document
                    .getElementById("strategy-modal")
                    .classList.remove("active");
                document.getElementById("strategy-form").reset();
                currentEditStrategy = null;
            }

            function editStrategy(strategy) {
                openStrategyModal(strategy);
            }

            async function deleteStrategy(name) {
                if (
                    !confirm(
                        `Are you sure you want to delete strategy "${name}"?`,
                    )
                )
                    return;

                try {
                    const response = await fetch(
                        `${API_BASE}/api/strategies/${encodeURIComponent(name)}`,
                        {
                            method: "DELETE",
                        },
                    );
                    const data = await response.json();

                    if (data.success) {
                        alert("Strategy deleted successfully!");
                        loadStrategies();
                    } else {
                        alert(`Failed to delete strategy: ${data.error}`);
                    }
                } catch (error) {
                    alert(`Error deleting strategy: ${error.message}`);
                }
            }

            document
                .getElementById("strategy-form")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const strategy = {
                        name: document.getElementById("strategy-name").value,
                        base_bet: parseFloat(
                            document.getElementById("base-bet").value,
                        ),
                        auto_cashout: parseFloat(
                            document.getElementById("auto-cashout").value,
                        ),
                        trigger_threshold: parseFloat(
                            document.getElementById("trigger-threshold").value,
                        ),
                        trigger_count: parseInt(
                            document.getElementById("trigger-count").value,
                        ),
                        max_consecutive_losses: parseInt(
                            document.getElementById("max-losses").value,
                        ),
                        bet_multiplier: parseFloat(
                            document.getElementById("bet-multiplier").value,
                        ),
                    };

                    try {
                        let response;
                        if (currentEditStrategy) {
                            response = await fetch(
                                `${API_BASE}/api/strategies/${encodeURIComponent(currentEditStrategy)}`,
                                {
                                    method: "PUT",
                                    headers: {
                                        "Content-Type": "application/json",
                                    },
                                    body: JSON.stringify(strategy),
                                },
                            );
                        } else {
                            response = await fetch(
                                `${API_BASE}/api/strategies`,
                                {
                                    method: "POST",
                                    headers: {
                                        "Content-Type": "application/json",
                                    },
                                    body: JSON.stringify(strategy),
                                },
                            );
                        }

                        const data = await response.json();

                        if (data.success) {
                            alert(
                                `Strategy ${currentEditStrategy ? "updated" : "created"} successfully!`,
                            );
                            closeStrategyModal();
                            loadStrategies();
                        } else {
                            alert(`Failed to save strategy: ${data.error}`);
                        }
                    } catch (error) {
                        alert(`Error saving strategy: ${error.message}`);
                    }
                });

            // Multipliers
            function getMultiplierClass(multiplier) {
                if (multiplier < 2.01) return "multiplier-green";
                if (multiplier < 5.01) return "multiplier-yellow";
                if (multiplier < 10.01) return "multiplier-white";
                return "multiplier-red";
            }

            function getMultiplierBetClass(bet) {
                if (!bet) return "";
                if (bet.outcome === "win") return "bet-win";
                if (bet.outcome === "loss") return "bet-loss";
                return "has-bet";
            }

            async function loadRecentMultipliers() {
                try {
                    const response = await fetch(
                        `${API_BASE}/api/multipliers/recent?limit=100`,
                    );
                    const data = await response.json();

                    const container =
                        document.getElementById("recent-multipliers");

                    if (
                        !data.success ||
                        !data.multipliers ||
                        data.multipliers.length === 0
                    ) {
                        container.innerHTML =
                            '<div class="loading">No multipliers yet</div>';
                        return;
                    }

                    container.innerHTML = data.multipliers
                        .reverse()
                        .map((m) => {
                            const colorClass = getMultiplierClass(m.multiplier);
                            const betClass = getMultiplierBetClass(m.bet);
                            const title = m.bet
                                ? `${m.bet.strategy_name}: ${m.bet.amount} (${m.bet.outcome}, ${m.bet.profit_loss >= 0 ? "+" : ""}${m.bet.profit_loss})`
                                : "";

                            return `
                        <div class="multiplier-item ${colorClass} ${betClass}" title="${title}">
                            ${m.multiplier.toFixed(2)}x
                        </div>
                    `;
                        })
                        .join("");
                } catch (error) {
                    console.error("Error loading recent multipliers:", error);
                }
            }

            // Bets
            async function loadBets() {
                try {
                    const response = await fetch(
                        `${API_BASE}/api/bets/current-session`,
                    );
                    const data = await response.json();

                    const tbody = document.getElementById("bets-tbody");

                    if (!data.success || !data.bets || data.bets.length === 0) {
                        tbody.innerHTML =
                            '<tr><td colspan="6" style="text-align: center; color: #aaa;">No bets yet</td></tr>';
                        return;
                    }

                    tbody.innerHTML = data.bets
                        .map((bet) => {
                            const outcomeClass =
                                bet.outcome === "win"
                                    ? "outcome-win"
                                    : "outcome-loss";
                            const profitClass =
                                bet.profit_loss >= 0
                                    ? "profit-positive"
                                    : "profit-negative";
                            const time = new Date(
                                bet.timestamp,
                            ).toLocaleTimeString();

                            return `
                        <tr>
                            <td>${time}</td>
                            <td>${bet.strategy_name}</td>
                            <td>${bet.bet_amount.toFixed(0)}</td>
                            <td>${bet.multiplier.toFixed(2)}x</td>
                            <td class="${outcomeClass}">${bet.outcome.toUpperCase()}</td>
                            <td class="${profitClass}">${bet.profit_loss >= 0 ? "+" : ""}${bet.profit_loss.toFixed(0)}</td>
                        </tr>
                    `;
                        })
                        .join("");
                } catch (error) {
                    console.error("Error loading bets:", error);
                }
            }

            // Sessions and Session Multipliers
            async function loadSessions() {
                try {
                    const response = await fetch(`${API_BASE}/api/sessions`);
                    const data = await response.json();

                    const select = document.getElementById("session-select");

                    if (
                        !data.success ||
                        !data.sessions ||
                        data.sessions.length === 0
                    ) {
                        select.innerHTML =
                            '<option value="">No sessions found</option>';
                        return;
                    }

                    select.innerHTML = data.sessions
                        .map((session) => {
                            const profit =
                                session.profit_loss !== null
                                    ? `(${session.profit_loss >= 0 ? "+" : ""}${session.profit_loss.toFixed(0)})`
                                    : "";
                            const date = new Date(
                                session.start_timestamp,
                            ).toLocaleString();

                            return `
                        <option value="${session.id}">
                            Session #${session.id} - ${date} - ${session.total_rounds} rounds ${profit}
                        </option>
                    `;
                        })
                        .join("");

                    // Load first session by default
                    if (data.sessions.length > 0) {
                        loadSessionMultipliers();
                    }
                } catch (error) {
                    console.error("Error loading sessions:", error);
                }
            }

            async function loadSessionMultipliers() {
                const sessionId =
                    document.getElementById("session-select").value;
                const container = document.getElementById(
                    "session-multipliers",
                );

                if (!sessionId) {
                    container.innerHTML =
                        '<div class="loading">Select a session to view multipliers</div>';
                    return;
                }

                container.innerHTML =
                    '<div class="loading">Loading session multipliers</div>';

                try {
                    const response = await fetch(
                        `${API_BASE}/api/sessions/${sessionId}/multipliers`,
                    );
                    const data = await response.json();

                    if (
                        !data.success ||
                        !data.multipliers ||
                        data.multipliers.length === 0
                    ) {
                        container.innerHTML =
                            '<div class="loading">No multipliers in this session</div>';
                        return;
                    }

                    container.innerHTML = data.multipliers
                        .reverse()
                        .map((m) => {
                            const colorClass = getMultiplierClass(m.multiplier);
                            const betClass = getMultiplierBetClass(m.bet);
                            const title = m.bet
                                ? `${m.bet.strategy_name}: ${m.bet.amount} (${m.bet.outcome}, ${m.bet.profit_loss >= 0 ? "+" : ""}${m.bet.profit_loss})`
                                : "";

                            return `
                        <div class="multiplier-item ${colorClass} ${betClass}" title="${title}">
                            ${m.multiplier.toFixed(2)}x
                        </div>
                    `;
                        })
                        .join("");
                } catch (error) {
                    console.error("Error loading session multipliers:", error);
                    container.innerHTML =
                        '<div class="loading">Error loading multipliers</div>';
                }
            }

            // Close modal when clicking outside
            document
                .getElementById("strategy-modal")
                .addEventListener("click", (e) => {
                    if (e.target.id === "strategy-modal") {
                        closeStrategyModal();
                    }
                });
        </script>
    </body>
</html>
